#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

ini_set('xdebug.max_nesting_level', 3000);
ini_set('xdebug.var_display_max_children', -1);
ini_set('xdebug.var_display_max_data', -1);
ini_set('xdebug.var_display_max_depth', -1);

use NamaeSpace\Stream\FileStream;
use NamaeSpace\Stream\StdStream;
use PhpParser\NodeTraverser;
use PhpParser\NodeVisitor\NameResolver;
use PhpParser\ParserFactory;
use PhpParser\PrettyPrinter\Standard;
use SebastianBergmann\Diff\Differ;
use Symfony\Component\Console\Application;
use Symfony\Component\Finder\Finder;
use NamaeSpace\Command\FindCommand;
use NamaeSpace\Command\ReplaceCommand;
use NamaeSpace\NodeBuilder\ReplaceNodeBuilder;

$parser = (new ParserFactory())->create(ParserFactory::PREFER_PHP5);
$traverser = new NodeTraverSer();
$traverser->addVisitor(new NameResolver());
$prettyPrinter = new Standard();
$finder = new Finder();
$replaceNodeBuilder = new ReplaceNodeBuilder($parser, $traverser);
$fileSystem = new FileStream($finder, $prettyPrinter);
$stdStream = new StdStream(new Differ());

$app = new Application();
$app->add(new ReplaceCommand($replaceNodeBuilder, $fileSystem, $stdStream));
$app->add(new FindCommand($parser, $traverser, $prettyPrinter, $fileSystem));
$app->run();
